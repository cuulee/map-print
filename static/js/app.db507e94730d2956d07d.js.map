{"version":3,"sources":["webpack:///./src/bus.js","webpack:///./src/appState.js","webpack:///./src/lib/postData.js","webpack:///./src/lib/query-presets.js","webpack:///./src/lib/bbox.js","webpack:///./src/lib/createProjector.js","webpack:///./src/lib/constructGraph.js","webpack:///./src/lib/formatNumber.js","webpack:///./src/main.js","webpack:///./src/lib/osm.js","webpack:///./src/lib/request.js"],"names":["bus","__webpack_require__","__webpack_exports__","graph","graphBounds","projector","appState","currentState","selected","aboutVisible","blank","error","kmlLayers","currentScript","showZoomWarning","possibleScripts","options","value","text","downloadOsmProgress","building","buildingMessage","zazzleLink","showCancelDownload","getGraphBBox","getGraph","setGraph","newGraph","bounds","newProjector","startOver","generatingPreview","backgroundColor","r","g","b","a","lineColor","getProjector","addKMLLayer","name","layer","push","viewModel","color","width","updateColor","getKMLLayer","makeKMLLayerViewModel","removeKMLLayer","layerModel","layerIndex","indexOf","Error","splice","overpassUrl","postData","data","progress","Object","request","method","responseType","headers","Content-type","body","encodeURIComponent","metaTags","highwayTags","join","query_presets","roads","bbox","waterway","buildings","rivers","BBox","classCallCheck_default","this","minX","Number","POSITIVE_INFINITY","minY","maxX","NEGATIVE_INFINITY","maxY","offset","xIn","yIn","undefined","x","y","rect","addPoint","left","top","right","bottom","otherBBox","d3geo","createGraph","asyncFor","constructGraph","osmResponse","filter","elements","lonLatBoundingBox","promise_default","resolve","addToBoundingBox","element","elementIdx","type","lon","lat","length","computeBoundingBox","then","lonLatBbox","q","geoMercator","center","cx","cy","scale","xyPoint","createProjector","visit","nodeData","addNode","id","nodes","forEach","node","idx","from","to","getNode","addLink","formatNumber","is_finite_default","toString","replace","e","bind","catch","oe","cancelDownload","main_map","map","updateZoomWarning","getZoom","downloadRoads","getBounds","sw","getSouthWest","ne","getNorthEast","boundingBox","lng","promise","downloadPromise","scriptKind","getRoadsInBoundingBox","updateDownloadProgress","el","cancel","updateConstructionProgress","_ref","getLinksCount","fire","err","cancelled","p","loaded","lengthComputable","total","percent","current","kind","totalStr","currentStr","init","mapboxgl","accessToken","Map","container","style","zoom","hash","addControl","NavigationControl","showCompass","on","dragRotate","disable","touchZoomRotate","disableRotation","url","req","cancelable","__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default","reject","XMLHttpRequest","addEventListener","status","response","JSON","parse","message","open","__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_keys___default","key","setRequestHeader","send","abort"],"mappings":"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","file":"static/js/app.db507e94730d2956d07d.js","sourcesContent":["var bus = require('ngraph.events')({});\n\nexport default bus;\n\n\n// WEBPACK FOOTER //\n// ./src/bus.js","// const ratio = 540/230 - mug\nconst appState = {\n  currentState: 'intro',\n  selected: null,\n  aboutVisible: false,\n  blank: false,\n  error: null,\n  kmlLayers: [],\n  currentScript: 'roads',\n  showZoomWarning: false,\n  possibleScripts: {\n    selected: 'roads',\n    options: [{\n      value: 'roads',\n      text: 'Roads'\n    }, {\n      value: 'buildings',\n      text: 'Buildings'\n    }, {\n      value: 'rivers',\n      text: 'Rivers'\n    }]\n  },\n  downloadOsmProgress: null,\n  building: false,\n  buildingMessage: '',\n  zazzleLink: null,\n  showCancelDownload: false,\n  getGraphBBox,\n  getGraph,\n  setGraph,\n  startOver,\n  generatingPreview: false,\n\n  backgroundColor: {\n    r: 255, g: 255, b: 255, a: 1\n  },\n  lineColor: {\n    r: 22, g: 22, b: 22, a: 0.85\n  },\n\n  getProjector,\n\n  addKMLLayer,\n  removeKMLLayer\n};\n\nvar graph;\nvar graphBounds;\n// projects lon/lat into current XY plane\nvar projector;\n\nfunction getGraphBBox() {\n  return graphBounds;\n}\n\nfunction getGraph() {\n  return graph;\n}\n\nfunction setGraph(newGraph, bounds, newProjector) {\n  graph = newGraph;\n  graphBounds = bounds;\n  projector = newProjector;\n}\n\nfunction getProjector() {\n  return projector;\n}\n\nfunction startOver() {\n  appState.zazzleLink = null;\n  appState.generatingPreview = false;\n  appState.currentState = 'intro';\n  appState.blank = false,\n  appState.downloadOsmProgress = null;\n  appState.kmlLayers = [];\n}\n\n\nfunction addKMLLayer(name, layer) {\n  appState.kmlLayers.push(makeKMLLayerViewModel(name, layer));\n}\n\nfunction removeKMLLayer(layerModel) {\n  let layerIndex = appState.kmlLayers.indexOf(layerModel);\n  if (layerIndex < 0) {\n    throw new Error('Invalid layer to remove');\n  }\n  appState.kmlLayers.splice(layerIndex, 1);\n}\n\nexport default appState;\n\nfunction makeKMLLayerViewModel(name, layer) {\n  const viewModel = {\n    name,\n    color: layer.color,\n    width: layer.width,\n    updateColor() {\n      layer.updateColor(viewModel.color);\n    },\n\n    getKMLLayer() { return layer }\n  }\n\n  return viewModel;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/appState.js","import request from './request';\n\nconst overpassUrl = 'https://overpass-api.de/api/interpreter' ;\n\nexport default function postData(data, progress) {\n  return request(overpassUrl, {\n    method: 'POST',\n    responseType: 'json',\n    progress,\n    headers: {\n      'Content-type': 'application/x-www-form-urlencoded; charset=UTF-8'\n    },\n    body: 'data=' + encodeURIComponent(data),\n  }, 'POST');\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/postData.js","const metaTags = '[timeout:9000][maxsize:2000000000][out:json];';\n\nconst highwayTags = [\n  'motorway',\n  'motorway_link',\n  'trunk',\n  'trunk_link',\n  'primary',\n  'primary_link',\n  'secondary',\n  'secondary_link',\n  'tertiary',\n  'tertiary_link',\n  'unclassified',\n  'unclassified_link',\n  'residential',\n  'residential_link',\n  'service',\n  'service_link',\n  'living_street',\n  'pedestrian',\n  'road'\n].join('|');\n\n\nexport default {\n  roads(bbox) {\n    return `${metaTags}\n(\n  way[\"highway\"~\"${highwayTags}\"](${bbox});\n  node(w);\n);\nout skel;`\n  },\n  waterway(bbox) {\n    return `${metaTags}\n(\n  way[\"waterway\"](${bbox});\n  node(w);\n);\nout skel;`\n  },\n  buildings(bbox) {\n    return `${metaTags}\n(\n  way[\"building\"](${bbox});\n  node(w);\n);\nout skel;`\n  },\n  rivers(bbox) {\n    return `${metaTags}\n(\n  way[\"waterway\"=\"river\"](${bbox});\n  node(w);\n);\nout skel;`\n  },\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/query-presets.js","export default class BBox {\n  constructor() {\n    this.minX = Number.POSITIVE_INFINITY;\n    this.minY = Number.POSITIVE_INFINITY;\n    this.maxX = Number.NEGATIVE_INFINITY;\n    this.maxY = Number.NEGATIVE_INFINITY;\n  }\n\n  growBy(offset) {\n    this.minX -= offset;\n    this.minY -= offset;\n    this.maxX += offset;\n    this.maxY += offset;\n  }\n\n  get left() {\n    return this.minX;\n  }\n\n  get top() {\n    return this.minY;\n  }\n\n  get right() {\n    return this.maxX;\n  }\n\n  get bottom() {\n    return this.maxY;\n  }\n\n  get width() {\n    return this.maxX - this.minX;\n  }\n\n  get height() {\n    return this.maxY - this.minY;\n  }\n\n  get cx() {\n    return (this.minX + this.maxX)/2;\n  }\n\n  get cy() {\n    return (this.minY + this.maxY)/2;\n  }\n\n  addPoint(xIn, yIn) {\n    if (xIn === undefined) throw new Error('Point is not defined');\n    let x = xIn;\n    let y = yIn;\n    if (y === undefined) {\n      // xIn is a point object\n      x = xIn.x;\n      y = xIn.y;\n    }\n\n    if (x < this.minX) this.minX = x;\n    if (x > this.maxX) this.maxX = x;\n    if (y < this.minY) this.minY = y;\n    if (y > this.maxY) this.maxY = y;\n  }\n\n  addRect(rect) {\n    if (!rect) throw new Error('rect is not defined');\n    this.addPoint(rect.left, rect.top);\n    this.addPoint(rect.right, rect.top);\n    this.addPoint(rect.left, rect.bottom);\n    this.addPoint(rect.right, rect.bottom);\n  }\n\n  merge(otherBBox) {\n    if (otherBBox.minX < this.minX) this.minX = otherBBox.minX;\n    if (otherBBox.minY < this.minY) this.minY = otherBBox.minY;\n    if (otherBBox.maxX > this.maxX) this.maxX = otherBBox.maxX;\n    if (otherBBox.maxY > this.maxY) this.maxY = otherBBox.maxY;\n  }\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/bbox.js","var d3geo = require('d3-geo')\n\nexport default function createProjector(lonLatBbox, r) {\n  if (!r) r = 6371393; // radius of earth in meters\n\n  var q = [0, 0];\n  var projector = d3geo.geoMercator()\n      .center([lonLatBbox.cx, lonLatBbox.cy])\n      .scale(r)\n\n  return function(lon, lat) {\n    q[0] = lon; q[1] = lat;\n\n    let xyPoint = projector(q)\n\n    return {\n      x: xyPoint[0],\n      y: xyPoint[1]\n    };\n  };\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/createProjector.js","import BBox from './bbox';\nimport createProjector from './createProjector';\nvar createGraph = require('ngraph.graph');\nvar asyncFor = require('rafor');\n\nexport default function constructGraph(osmResponse, filter, progress) {\n  var {elements} = osmResponse;\n\n  return computeBoundingBox().then(constructGraphAndBounds);\n\n  function computeBoundingBox() {\n    var lonLatBoundingBox = new BBox();\n\n    return new Promise(resolve => {\n      asyncFor(elements, addToBoundingBox, () => {\n          resolve(lonLatBoundingBox);\n        }\n      );\n    });\n\n    function addToBoundingBox(element, elementIdx) {\n      if (element.type === 'node') {\n        lonLatBoundingBox.addPoint(element.lon, element.lat);\n      }\n      if ((elementIdx % 50000) === 0) {\n        progress(elementIdx, elements.length, 'bounds');\n      }\n    }\n  }\n\n  function constructGraphAndBounds(lonLatBoundingBox) {\n    var projector = createProjector(lonLatBoundingBox);\n    var graph = createGraph();\n    var offset = new BBox();\n\n    return new Promise(resolve => {\n      asyncFor(elements, visit, () => resolve({\n        graph, \n        projector,\n        bounds: offset\n      }));\n    })\n\n    function visit(element, elementIdx) {\n      if (element.type === 'node') {\n        if (filter && !filter(element)) {\n          return;\n        }\n        var nodeData = projector(element.lon, element.lat);\n        offset.addPoint(nodeData.x, nodeData.y);\n        graph.addNode(element.id, nodeData)\n      } else if (element.type === 'way') {\n        element.nodes.forEach((node, idx) => {\n          if (idx > 0) {\n            const from = element.nodes[idx - 1];\n            const to = element.nodes[idx];\n            if (graph.getNode(from) && graph.getNode(to)) {\n              graph.addLink(from, to);\n            }\n          } \n        })\n      }\n\n      if ((elementIdx % 50000) === 0) {\n        progress(elementIdx, elements.length, 'graph');\n      }\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/constructGraph.js","export default function formatNumber(x) {\n  if (!Number.isFinite(x)) return 'N/A';\n  return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/lib/formatNumber.js","/* global mapboxgl */\nimport * as osm from './lib/osm';\nimport appState from './appState';\nimport bus from './bus';\nimport constructGraph from './lib/constructGraph';\nimport createBoundaryHighlighter from './lib/createBoundaryHighlighter';\nimport formatNumber from './lib/formatNumber';\n\nrequire.ensure('@/vueApp.js', () => {\n  // Settings UI is ready, initialize vue.js application\n  require('@/vueApp.js');\n});\n\nlet map;\nvar cancelDownload;\n\nappState.init = function() {\n  mapboxgl.accessToken = 'pk.eyJ1IjoiYW52YWthIiwiYSI6ImNqaWUzZmhqYzA1OXMza213YXh2ZzdnOWcifQ.t5yext53zn1c9Ixd7Y41Dw';\n  map = new mapboxgl.Map({\n      container: 'map',\n      style: 'mapbox://styles/mapbox/streets-v9',\n      center: [-122.2381,47.624],\n      zoom: 11.32,\n      hash: true\n  });\n\n  map.addControl(new mapboxgl.NavigationControl({\n    showCompass: false,\n  }), 'bottom-right');\n  map.on('zoom', updateZoomWarning);\n  map.dragRotate.disable();\n  map.touchZoomRotate.disableRotation();\n\n  updateZoomWarning();\n\n  bus.on('download-all-roads', downloadRoads);\n  bus.on('cancel-download-all-roads', () => {\n    if (cancelDownload) cancelDownload();\n  });\n};\n\n// document.body.addEventListener('touchmove', (event) => event.stopPropagation());\n\nfunction updateZoomWarning() {\n  appState.showZoomWarning = map.getZoom() < 9.7;\n}\n\nfunction downloadRoads() {\n  const bounds = map.getBounds();\n  const sw = bounds.getSouthWest();\n  const ne = bounds.getNorthEast()\n  const boundingBox = `${sw.lat},${sw.lng},${ne.lat},${ne.lng}`;\n  appState.building = true;\n  appState.buildingMessage = 'Sending query to OSM...'\n  appState.blank = false;\n  appState.error = null;\n\n  const scriptKind = appState.possibleScripts.selected;\n  const downloadPromise = osm.getRoadsInBoundingBox(scriptKind, boundingBox, updateDownloadProgress);\n\n  renderAfterResolution(downloadPromise, el => {\n    return el.lon >= sw.lng && el.lon <= ne.lng &&\n           el.lat >= sw.lat && el.lat <= ne.lat;\n  });\n}\n\nfunction updateDownloadProgress(p) {\n  let loaded = formatNumber(p.loaded);\n\n  if (p.lengthComputable) {\n    let total = formatNumber(p.total);\n    appState.buildingMessage = `Downloading data: ${p.percent * 100}% (${loaded} of ${total} bytes)`;\n  } else {\n    appState.buildingMessage = `Downloading data: ${loaded} bytes so far...`;\n  }\n}\n\nfunction renderAfterResolution(promise, filter) {\n  cancelDownload = promise.cancel;\n  appState.showCancelDownload = true;\n\n  promise.then(osmResponse => {\n    cancelDownload = null;\n    appState.showCancelDownload = false;\n    return constructGraph(osmResponse, filter, updateConstructionProgress);\n  }).then(({graph, bounds, projector}) => {\n    appState.setGraph(graph, bounds, projector);\n    appState.building = false;\n\n    if (graph.getLinksCount() === 0) {\n      appState.blank = true;\n    } else {\n      appState.currentState = 'canvas';\n      appState.blank = false;\n      bus.fire('graph-loaded');\n    }\n  }).catch(err => {\n    if (err && err.cancelled) {\n      cancelDownload = null;\n      appState.building = false;\n      appState.showCancelDownload = false;\n    } else {\n      appState.building = false;\n      appState.error = err;\n    }\n  });\n}\n\nfunction updateConstructionProgress(current, total, kind) {\n  let totalStr = formatNumber(total);\n  let currentStr = formatNumber(current);\n  if (kind === 'graph') {\n    appState.buildingMessage = `Making graph: ${currentStr} of ${totalStr} records`;\n  } else {\n    appState.buildingMessage = `Computing bounds: ${currentStr} of ${totalStr} records`;\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.js","import postData from './postData';\n\nimport queryPresets from './query-presets';\n\nexport function getAreasAround(lonLat, bounds) {\n  var sw = bounds.getSouthWest();\n  var ne = bounds.getNorthEast()\n  return postData(\n    `[timeout:10][out:json];\nis_in(${lonLat.lat}, ${lonLat.lng})->.a;\nway(pivot.a);\nout tags bb;\nout ids geom(${sw.lat},${sw.lng},${ne.lat},${ne.lng});\nrelation(pivot.a);\nout tags bb;`\n  );\n}\n\nexport function getRelationBoundary(relId) {\n  return postData(`[timeout:10][out:json];\nrel(${relId});\n(\n  way(r);\n  node(w);\n);\nout skel;`).then(response => {\n  var nodes = new Map();\n  var ways = [];\n  response.elements.forEach(el => {\n    if (el.type === 'node') {\n      nodes.set(el.id, el);\n    } else if (el.type === 'way') {\n      ways.push(el);\n    }\n  });\n  return {\n    nodes, ways\n  }\n})\n}\n\nexport function getRoadsInBoundingBox(scriptKind, boundingBox, progress) {\n  return postData(queryPresets[scriptKind](boundingBox) , progress);\n}\n\nexport function getRoadsInRelationship(relId) {\n  return postData(\n  `[timeout:9000][maxsize:2000000000][out:json];\nrel(${relId});\nmap_to_area->.a;\n(\n way[\"waterway\"](area.a);\n node(w);\n);\nout skel;`);\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/osm.js","export default function request(url, options) {\n  if (!options) options = {};\n  let req;\n  let cancelable = new Promise(download);\n  cancelable.cancel = cancel;\n\n  return cancelable;\n\n  function cancel() {\n    if (req) {\n      req.abort();\n    }\n  }\n\n  function download(resolve, reject) {\n    req = new XMLHttpRequest();\n\n    if (typeof options.progress === 'function') {\n      req.addEventListener('progress', updateProgress, false);\n      // req.upload.addEventListener('progress', updateProgress, false);\n    }\n\n    req.addEventListener('load', transferComplete, false);\n    req.addEventListener('error', transferFailed, false);\n    req.addEventListener('abort', transferCanceled, false);\n\n    req.open(options.method || 'GET', url);\n    if (options.responseType) {\n      req.responseType = options.responseType;\n    }\n    if (options.headers) {\n      Object.keys(options.headers).forEach(key => {\n        req.setRequestHeader(key, options.headers[key]);\n      });\n    }\n\n    if (options.method === 'POST') {\n      req.send(options.body);\n    } else {\n      req.send(null);\n    }\n\n    function updateProgress(e) {\n      if (e.lengthComputable) {\n        options.progress({\n          loaded: e.loaded,\n          total: e.total,\n          percent: e.loaded / e.total,\n          lengthComputable: true\n        });\n      } else {\n        options.progress({\n          loaded: e.loaded,\n          lengthComputable: false\n        });\n      }\n    }\n\n    function transferComplete() {\n      if (req.status !== 200) {\n        reject(`Unexpected status code ${req.status} when calling ${url}`);\n        return;\n      }\n      var response = req.response;\n\n      if (options.responseType === 'json' && typeof response === 'string') {\n        // IE\n        response = JSON.parse(response);\n      }\n\n      resolve(response);\n    }\n\n    function transferFailed() {\n      reject(`Failed to download ${url}`);\n    }\n\n    function transferCanceled() {\n      reject({\n        cancelled: true,\n        message: `Cancelled download of ${url}`\n      });\n    }\n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/lib/request.js"],"sourceRoot":""}